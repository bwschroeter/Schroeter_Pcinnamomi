```{r, libs, message=FALSE}
library(readxl)
library("kableExtra")
library(WGCNA)
library(tidyverse)
library(gridExtra)
library(reshape2)
library(dplyr)
library(edgeR)
library(clusterProfiler)
library(BiocGenerics)
library(GenomicFeatures)
library(Biostrings)
library(rtracklayer)
```

download .faa file https://ftp.ncbi.nlm.nih.gov/genomes/genbank/protozoa/Phytophthora_cinnamomi/latest_assembly_versions/GCA_018691715.1_ASM1869171v1/GCA_018691715.1_ASM1869171v1_protein.faa.gz
```{r}
# Read the .faa file
faa_file <- "GCA_018691715.1_ASM1869171v1_protein.faa"  
sequences <- readAAStringSet(faa_file, format = "fasta")

formatted_sequences <- paste0(">", names(sequences), "\n", as.character(sequences), "\n")
output_file <- "/mnt/data/barry/projects/Schroeter_Pcinnamomi/PcEffector/Pcgenes.fasta" 
writeLines(formatted_sequences, output_file)


load("Pceffetor.RData")

# first rearrange cols
allgenes <- detectedgenes
allgenes$gene_id<-rownames(allgenes)
rownames(allgenes)<-seq(nrow(allgenes))
head(allgenes)


Pcgenenames <- read.table('pcgeneids.tsv', row.names = 1, quote = "", sep='\t', fill = TRUE, header = TRUE)

pcprotein.id <- dplyr::right_join(Pcgenenames, allgenes, by = 'gene_id')


# Define a list of protein IDs to extract
protein_list <- pcprotein.id$protein_id


```

```{r}
# Read the .faa file
faa_file <- "GCA_018691715.1_ASM1869171v1_protein.faa"  
sequences <- readAAStringSet(faa_file)

# Extract headers and sequences
headers <- names(sequences)
sequence_strings <- as.character(sequences)

# Extract protein identifiers from headers
protein_identifiers <- sub("^>(\\S+).*", "\\1", headers)

# Create a data frame with protein identifiers and sequences
df <- data.frame(protein_id = protein_identifiers, Sequence = sequence_strings, stringsAsFactors = FALSE)

# Filter the "ProteinID" column to include only the first 12 characters
df$protein_id <- substr(df$protein_id, 1, 12)

# Print the updated data frame
print(df)

pcprotein.idfaa <- dplyr::right_join(df, pcprotein.id, by = 'protein_id')

```

```{r}
split_fasta_chunks <- function(df, chunk_size, output_dir) {
  # Create a list of data frames, each containing a chunk of the original data frame
  df_chunks <- split(df, ceiling(seq_len(nrow(df)) / chunk_size))
  
  # Define a function to write a chunk to a FASTA file
  write_fasta_chunk <- function(chunk, file_path) {
    fasta_string <- paste0(">", chunk$protein_id, "\n", chunk$Sequence, "\n")
    writeLines(fasta_string, con = file_path)
  }
  
  # Write each chunk to a separate FASTA file
  file_names <- paste0("output_", 1:length(df_chunks), ".fasta")
  file_paths <- file.path(output_dir, file_names)
  lapply(seq_along(df_chunks), function(i) {
    write_fasta_chunk(df_chunks[[i]], file_paths[i])
  })
}

# Usage example
output_dir <- "/mnt/data/barry/projects/Schroeter_Pcinnamomi/PcEffector/chunkoutput"  
chunk_size <- 1000

split_fasta_chunks(pcprotein.idfaa, chunk_size, output_dir)
```

```{r}
read_tsv('signalP3.0_output_1.txt')
```







Get supplementary files from https://rdcu.be/dcczO
https://static-content.springer.com/esm/art%3A10.1186%2Fs12864-021-07552-y/MediaObjects/12864_2021_7552_MOESM2_ESM.xls

```{r, Engelbrecht supp}
pcrxlr <- read_xls('12864_2021_7552_MOESM2_ESM.xls', 
                   sheet = 'TableS2',
                   col_names = F,
                   range = 'A3:A183') 
# Rename the column
colnames(pcrxlr) <- c("gene_id")

# Remove the last three characters of each row
pcrxlr$gene_id <- substr(pcrxlr$gene_id, 1, nchar(pcrxlr$gene_id) - 3)

as.data.frame(pcrxlr)

head(pcrxlr)
```

```{r}
rxlr.df <- dplyr::right_join(pcprotein.id, pcrxlr, by = 'gene_id')

```

